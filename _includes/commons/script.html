<!-- jQuery -->
<script src="{{ "/assets/js/jquery.min.js " | prepend: site.baseurl }}"></script>
<!-- Bootstrap Core JavaScript -->
<script src="{{ "/assets/js/bootstrap.min.js " | prepend: site.baseurl }}"></script>

<!-- Custom Theme JavaScript -->
<script src="{{ "/assets/js/clean-blog.min.js " | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/unslider-min.js " | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/lodash.js " | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/js/moment.js " | prepend: site.baseurl }}"></script>
<script>
  (function() {
    var script = document.createElement("script");

    script.type = "text/javascript";
    script.src = "//sd.toneden.io/production/v2/toneden.loader.js";

    var entry = document.getElementsByTagName("script")[0];
    entry.parentNode.insertBefore(script, entry);
  }());

  // TODO: put all javascript in the file once finished with plugins
  $(document).ready(function() {
    $('.testimonial-text #js-slider').unslider({
      autoplay: true,
      delay: 6000,
      infinite: true
    });

    ToneDenReady = window.ToneDenReady || [];
    ToneDenReady.push(function() {

      ToneDen.configure({
        "soundcloudConsumerKey": "7f3673aff74a6fe5cf24893e4c68ebe7"
      });

      ToneDen.player.create({
        "dom": "#js-player-container-default",
        "skin": "light",
        "shrink": false,
        "visualizerType":"waves",
        "urls": ['https://soundcloud.com/phil_wc/sets/reverbtheme']
      });

      ToneDen.player.create({
        "dom": "#js-player-container-mobile",
        "skin": "light",
        "shrink": false,
        "visualizerType":"waves",
        "urls": ['https://soundcloud.com/phil_wc/sets/reverbtheme']
      });
    });
  });

// ajax shit
var ajaxOptions = { url: '/feed.xml', type: 'GET', dataType: 'xml'}

$.ajax(ajaxOptions)
  .done(function(data) {
    var json_rss = parseRSSFeed(data);
    generateNewsPost(json_rss);
  });

var parseRSSFeed = function (data){
  var rsslist = [];
  var $xml = $(data);

  $xml.find("item").each(function() {
    var $this = $(this),
      item = {
        title: $this.find("title").text(),
        published: $this.find("pubDate").text(),
        urlPath: $this.find("link").text(),
        author: $this.find("author").text()
    };
    rsslist.push(item);
  });
  return rsslist;
};

var generateNewsPost = function (rss) {
  var template = $('.news-item-template').html();

  // slice the array, limited to three post
  var rssLimitedPost = _.slice(rss, 0, 3);

  _.each(rssLimitedPost, function (post) {
    var markup = template;

    markup = markup.replace('__URLPATH__',post.urlPath);
    markup = markup.replace('__TITLE__',post.title);
    markup = markup.replace('__PUBLISHED__',moment(post.published).format('MMMM, D YYYY'));
    markup = markup.replace('__AUTHOR__',post.author ? post.author : 'CHAPAVICH');

    $('.recent-news-list').append(markup);
  });
};

</script>